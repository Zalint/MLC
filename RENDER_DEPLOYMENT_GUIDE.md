# Matix Livreur - Render Deployment Guide

## üìã Prerequisites

1. **Render Account**: Sign up at [render.com](https://render.com)
2. **GitHub Repository**: Your code should be in a GitHub repository
3. **PostgreSQL Database**: Will be created on Render

## üóÑÔ∏è Database Setup

### Step 1: Create PostgreSQL Database

1. Go to your Render Dashboard
2. Click **"New +"** ‚Üí **"PostgreSQL"**
3. Configure the database:
   - **Name**: `matix-livreur-db`
   - **Database Name**: `matix_livreur`
   - **User**: `matix_user`
   - **Region**: Choose closest to your users
   - **Plan**: Start with **Starter** (free)

4. Click **"Create Database"**
5. Wait for the database to be created (takes 2-3 minutes)

### Step 2: Initialize Database Schema

1. Once the database is ready, go to the database dashboard
2. Click **"Connect"** ‚Üí **"External Connection"**
3. Copy the **External Database URL**
4. Use a PostgreSQL client (like pgAdmin, DBeaver, or psql) to connect
5. Run the SQL script from `render_database_setup.sql`

**Alternative: Using psql command line:**
```bash
# Replace with your actual database URL
psql "postgresql://matix_user:password@hostname:port/matix_livreur" -f render_database_setup.sql
```

### Step 3: Generate User Password Hashes

1. Run the hash generation script:
```bash
cd backend
node ../generate_user_hashes.js
```

2. Copy the generated SQL INSERT statement
3. Execute it in your database to create initial users

## üöÄ Backend Deployment

### Step 1: Create Backend Service

1. In Render Dashboard, click **"New +"** ‚Üí **"Web Service"**
2. Connect your GitHub repository
3. Configure the service:
   - **Name**: `matix-livreur-backend`
   - **Environment**: `Node`
   - **Region**: Same as your database
   - **Branch**: `main` (or your default branch)
   - **Root Directory**: Leave empty
   - **Build Command**: `cd backend && npm install`
   - **Start Command**: `cd backend && npm start`

### Step 2: Configure Environment Variables

Add these environment variables in the service settings:

```
NODE_ENV=production
BACKEND_PORT=4000
JWT_SECRET=[Auto-generated by Render]
SESSION_SECRET=[Auto-generated by Render]
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
```

**Database Variables** (get these from your database dashboard):
```
DB_HOST=[Your database hostname]
DB_PORT=5432
DB_NAME=matix_livreur
DB_USER=matix_user
DB_PASSWORD=[Your database password]
```

### Step 3: Deploy Backend

1. Click **"Create Web Service"**
2. Wait for the build and deployment (5-10 minutes)
3. Test the health endpoint: `https://your-backend-url.onrender.com/api/health`

## üåê Frontend Deployment

### Step 1: Update Frontend Configuration

Before deploying, update your frontend to point to the backend:

1. In your frontend JavaScript files, replace localhost URLs with your backend URL
2. Update API base URL to: `https://your-backend-url.onrender.com`

### Step 2: Create Frontend Service

1. In Render Dashboard, click **"New +"** ‚Üí **"Web Service"**
2. Connect the same GitHub repository
3. Configure the service:
   - **Name**: `matix-livreur-frontend`
   - **Environment**: `Node`
   - **Region**: Same as backend
   - **Branch**: `main`
   - **Root Directory**: Leave empty
   - **Build Command**: `cd frontend && npm install`
   - **Start Command**: `cd frontend && npm start`

### Step 3: Configure Frontend Environment Variables

```
NODE_ENV=production
FRONTEND_PORT=3000
BACKEND_URL=https://your-backend-url.onrender.com
```

### Step 4: Deploy Frontend

1. Click **"Create Web Service"**
2. Wait for deployment
3. Test your application at: `https://your-frontend-url.onrender.com`

## üîß Post-Deployment Configuration

### Update CORS Settings

1. Go to your backend service environment variables
2. Add:
```
FRONTEND_URL=https://your-frontend-url.onrender.com
```

3. Redeploy the backend service

### SSL/HTTPS

Render automatically provides SSL certificates for all services. Your URLs will be:
- Backend: `https://matix-livreur-backend.onrender.com`
- Frontend: `https://matix-livreur-frontend.onrender.com`

## üìä Monitoring and Maintenance

### Health Checks

- Backend health: `https://your-backend-url.onrender.com/api/health`
- Monitor service logs in Render dashboard

### Database Backups

1. Go to your database dashboard
2. Enable automatic backups (recommended)
3. Set backup retention period

### Scaling

- **Free Tier**: Services sleep after 15 minutes of inactivity
- **Paid Plans**: Always-on services with better performance
- Upgrade when you have consistent traffic

## üîí Security Considerations

### Environment Variables

- Never commit `.env` files to Git
- Use Render's environment variable management
- Rotate secrets regularly

### Database Security

- Use strong passwords
- Limit database access to your services only
- Regular security updates

### CORS Configuration

The backend is configured to accept requests from:
- Your frontend domain
- Any `.onrender.com` subdomain
- Localhost (for development)

## üêõ Troubleshooting

### Common Issues

1. **Build Failures**
   - Check build logs in Render dashboard
   - Ensure all dependencies are in `package.json`
   - Verify Node.js version compatibility

2. **Database Connection Issues**
   - Verify database credentials
   - Check if database is running
   - Ensure network connectivity

3. **CORS Errors**
   - Verify frontend URL in backend environment variables
   - Check CORS configuration in `backend/app.js`

4. **Service Won't Start**
   - Check start command
   - Verify port configuration
   - Review application logs

### Getting Help

- Check Render documentation: [render.com/docs](https://render.com/docs)
- Review service logs in dashboard
- Contact Render support for platform issues

## üìù Deployment Checklist

- [ ] Database created and initialized
- [ ] Initial users created with proper password hashes
- [ ] Backend service deployed and health check passing
- [ ] Frontend service deployed and accessible
- [ ] CORS configured correctly
- [ ] Environment variables set
- [ ] SSL certificates active
- [ ] Application functionality tested

## üîÑ Updates and Redeployment

### Automatic Deployments

Render automatically redeploys when you push to your connected Git branch.

### Manual Deployment

1. Go to service dashboard
2. Click **"Manual Deploy"**
3. Select branch and deploy

### Database Migrations

For schema changes:
1. Create migration SQL files
2. Run them manually in database
3. Or create a migration script in your application

---

**Note**: Replace placeholder URLs and credentials with your actual values during deployment. 