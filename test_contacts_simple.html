<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Simple - Fonctionnalit√© Contacts</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .input-group {
            display: flex;
            align-items: stretch;
        }
        .input-group input {
            flex: 1;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }
        .input-group .btn {
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
            border-left: none;
            padding: 8px 12px;
            background: #007bff;
            color: white;
            border: 1px solid #007bff;
            cursor: pointer;
        }
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-primary {
            background: #007bff;
            color: white;
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            background: #f8f9fa;
            border-left: 4px solid #007bff;
        }
        .result.success {
            background: #d4edda;
            border-left-color: #28a745;
        }
        .result.error {
            background: #f8d7da;
            border-left-color: #dc3545;
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        .contact-item {
            padding: 10px;
            margin: 5px 0;
            background: #e9ecef;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .contact-info {
            flex: 1;
        }
        .contact-name {
            font-weight: 600;
            color: #333;
        }
        .contact-phone {
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Test Simple - Fonctionnalit√© Contacts</h1>
        <p>Test du bouton de s√©lection de contacts et du pr√©-remplissage</p>

        <!-- Formulaire de test -->
        <form id="test-form">
            <div class="form-group">
                <label for="order-type">Type de commande</label>
                <select id="order-type" name="order_type">
                    <option value="">S√©lectionner un type</option>
                    <option value="MATA">MATA</option>
                    <option value="MLC">MLC</option>
                    <option value="AUTRE">AUTRE</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="client-name">Nom du client</label>
                <div class="input-group">
                    <input type="text" id="client-name" name="client_name" placeholder="Nom du client">
                    <button type="button" id="select-contact-btn" class="btn btn-secondary" title="S√©lectionner depuis les contacts">
                        üì±
                    </button>
                </div>
            </div>
            
            <div class="form-group">
                <label for="phone-number">Num√©ro de t√©l√©phone</label>
                <input type="tel" id="phone-number" name="phone_number" placeholder="Ex: 773920000">
            </div>
            
            <div class="form-group">
                <label for="address">Adresse</label>
                <input type="text" id="address" name="address" placeholder="Adresse de livraison">
            </div>
        </form>

        <!-- R√©sultats -->
        <div id="results"></div>
    </div>

    <!-- Modal de s√©lection de contacts -->
    <div id="contact-modal" class="modal">
        <div class="modal-content">
            <h3>S√©lectionner un contact (Mode Test)</h3>
            <p>Contacts de test disponibles :</p>
            
            <div id="contacts-list">
                <!-- Les contacts seront ajout√©s ici -->
            </div>
            
            <div style="margin-top: 20px; text-align: right;">
                <button type="button" class="btn btn-secondary" onclick="closeModal()">
                    Fermer
                </button>
            </div>
        </div>
    </div>

    <script>
        // Contacts de test
        const mockContacts = [
            { name: 'Jean Dupont', phone: '773920001', address: '123 Rue de la Paix, Dakar' },
            { name: 'Marie Martin', phone: '773920002', address: '456 Avenue Georges Bush, Dakar' },
            { name: 'Pierre Durand', phone: '773920003', address: '789 Boulevard de la Corniche, Dakar' },
            { name: 'Sophie Bernard', phone: '773920004', address: '321 Rue des Ambassadeurs, Dakar' },
            { name: 'Michel Petit', phone: '773920005', address: '654 Avenue Cheikh Anta Diop, Dakar' }
        ];

        // Clients de test (simulation base de donn√©es)
        const mockClients = [
            {
                name: 'Jean Dupont (Test)',
                phone: '773920001',
                address: '123 Rue de la Paix, Dakar',
                adresse_source: 'O.Foire',
                adresse_destination: 'Sicap Libert√© 2, Dakar',
                point_de_vente: 'O.Foire',
                order_type: 'MATA'
            },
            {
                name: 'Marie Martin (Test)',
                phone: '773920002',
                address: '456 Avenue Georges Bush, Dakar',
                adresse_source: 'Point E, Dakar',
                adresse_destination: 'Yoff, Dakar',
                point_de_vente: null,
                order_type: 'MLC'
            },
            {
                name: 'Pierre Durand (Test)',
                phone: '773920003',
                address: '789 Boulevard de la Corniche, Dakar',
                adresse_source: 'Plateau, Dakar',
                adresse_destination: 'M√©dina, Dakar',
                point_de_vente: null,
                order_type: 'AUTRE'
            }
        ];

        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Page de test charg√©e');
            setupEventListeners();
            loadContacts();
        });

        function setupEventListeners() {
            // Bouton de s√©lection de contacts
            const selectContactBtn = document.getElementById('select-contact-btn');
            if (selectContactBtn) {
                selectContactBtn.addEventListener('click', () => {
                    console.log('üñ±Ô∏è Clic sur le bouton de s√©lection de contacts');
                    showModal();
                });
            }

            // Recherche automatique lors de la saisie du t√©l√©phone
            const phoneNumberInput = document.getElementById('phone-number');
            if (phoneNumberInput) {
                phoneNumberInput.addEventListener('blur', (e) => {
                    const phoneNumber = e.target.value.trim();
                    if (phoneNumber && phoneNumber.length >= 6) {
                        console.log(`üìû Recherche automatique pour: ${phoneNumber}`);
                        autoFillClientInfo(phoneNumber);
                    }
                });
            }

            // Gestion du type de commande
            const orderTypeSelect = document.getElementById('order-type');
            if (orderTypeSelect) {
                orderTypeSelect.addEventListener('change', (e) => {
                    console.log(`üìã Type de commande s√©lectionn√©: ${e.target.value}`);
                });
            }
        }

        function loadContacts() {
            const contactsList = document.getElementById('contacts-list');
            if (!contactsList) return;

            contactsList.innerHTML = mockContacts.map(contact => `
                <div class="contact-item" data-phone="${contact.phone}" data-name="${contact.name}">
                    <div class="contact-info">
                        <div class="contact-name">${contact.name}</div>
                        <div class="contact-phone">${contact.phone}</div>
                    </div>
                    <button type="button" class="btn btn-primary" onclick="selectContact('${contact.name}', '${contact.phone}')">
                        S√©lectionner
                    </button>
                </div>
            `).join('');
        }

        function showModal() {
            console.log('üì± Ouverture du modal de s√©lection de contacts');
            document.getElementById('contact-modal').style.display = 'flex';
            addResult('Modal ouvert avec succ√®s', 'success');
        }

        function closeModal() {
            console.log('‚ùå Fermeture du modal');
            document.getElementById('contact-modal').style.display = 'none';
        }

        function selectContact(name, phone) {
            console.log(`üì± Contact s√©lectionn√©: ${name} - ${phone}`);
            
            // Remplir le formulaire
            document.getElementById('client-name').value = name;
            document.getElementById('phone-number').value = phone;
            
            // Fermer le modal
            closeModal();
            
            // Pr√©-remplir les informations client
            autoFillClientInfo(phone);
            
            addResult(`Contact s√©lectionn√©: ${name}`, 'success');
        }

        function autoFillClientInfo(phoneNumber) {
            console.log(`üîÑ Pr√©-remplissage automatique pour: ${phoneNumber}`);
            
            // Chercher le client dans la base de donn√©es simul√©e
            const client = mockClients.find(c => c.phone === phoneNumber);
            if (!client) {
                console.log(`‚ö†Ô∏è Aucun client trouv√© pour: ${phoneNumber}`);
                addResult(`Aucun client trouv√© pour ${phoneNumber}`, 'error');
                return;
            }

            // Pr√©-remplir l'adresse
            if (client.address) {
                document.getElementById('address').value = client.address;
            }

            console.log('‚úÖ Pr√©-remplissage termin√©');
            addResult(`Client trouv√©: ${client.name} (${client.order_type})`, 'success');
        }

        function addResult(message, type = 'info') {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${type}`;
            resultDiv.textContent = message;
            resultsDiv.appendChild(resultDiv);
        }

        // Logs initiaux
        console.log('üì± API Contacts disponible: ' + ('contacts' in navigator && 'ContactsManager' in window));
        console.log('‚úÖ Mode test activ√© - utilisation des donn√©es mock');
    </script>
</body>
</html> 