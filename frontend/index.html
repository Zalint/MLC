<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matix Livreur - Gestion des Commandes et Livraisons</title>
    <meta name="description" content="Plateforme de gestion des commandes, livraisons et analyse de satisfaction client pour Matix Livreur">
    <link rel="stylesheet" href="css/styles.css?v=1.2">
    <!-- Leaflet for interactive maps (local) -->
    <link rel="stylesheet" href="assets/leaflet/leaflet.css" />
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
</head>
<body>
    <!-- Loader -->
    <div id="loader" class="loader">
        <div class="loader-spinner"></div>
        <p>Chargement...</p>
    </div>

    <!-- Header -->
    <header id="header" class="header hidden">
        <div class="header-content">
            <div class="logo">
                <h1>Matix Livreur</h1>
            </div>
            <div class="user-info">
                <span id="username"></span>
                <span id="user-role" class="role-badge"></span>
                <button id="logout-btn" class="btn btn-secondary btn-sm">
                    <span class="icon">🚪</span>
                    Déconnexion
                </button>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav id="navigation" class="navigation hidden">
        <div class="nav-container">
            <button class="nav-item" data-page="dashboard">
                <span class="icon">📊</span>
                <span class="text">Tableau de bord</span>
            </button>
            <button class="nav-item hidden" id="nav-monthly-dashboard" data-page="monthly-dashboard">
                <span class="icon">📈</span>
                <span class="text">Tableau de bord mensuel</span>
            </button>
            <button class="nav-item hidden" id="nav-mata-monthly-dashboard" data-page="mata-monthly-dashboard">
                <span class="icon">🛒</span>
                <span class="text">Tableau MATA mensuel</span>
            </button>
            <button class="nav-item hidden" id="nav-mlc-table" data-page="mlc-table">
                <span class="icon">📋</span>
                <span class="text">Tableau MLC</span>
            </button>
            <button class="nav-item" data-page="new-order">
                <span class="icon">➕</span>
                <span class="text">Nouvelle commande</span>
            </button>
            <button class="nav-item" data-page="orders">
                <span class="icon">📋</span>
                <span class="text">Commandes</span>
            </button>
            <button class="nav-item hidden" id="nav-expenses" data-page="expenses">
                <span class="icon">📊</span>
                <span class="text">Dépenses</span>
            </button>
            <button class="nav-item hidden" id="nav-users" data-page="users">
                <span class="icon">👥</span>
                <span class="text">Utilisateurs</span>
            </button>
            <button class="nav-item hidden" id="nav-subscriptions" data-page="subscriptions">
                <span class="icon">🎫</span>
                <span class="text">Packs MLC</span>
            </button>
            <button class="nav-item" id="nav-livreurs" data-page="livreurs" style="display: none;">
                <span class="icon">🚚</span>
                <span class="text">Gestion livreurs</span>
            </button>
                    <button class="nav-item hidden" id="nav-gps-tracking" data-page="gps-tracking">
            <span class="icon">🗺️</span>
            <span class="text">Suivi GPS</span>
        </button>
        
        <button class="nav-item hidden" id="nav-gps-analytics" data-page="gps-analytics">
            <span class="icon">📊</span>
            <span class="text">Analytics GPS</span>
        </button>
            <button class="nav-item hidden" id="nav-my-performance" data-page="my-performance">
                <span class="icon">📈</span>
                <span class="text">Mes Performances</span>
            </button>
            <button class="nav-item" data-page="profile">
                <span class="icon">👤</span>
                <span class="text">Profil</span>
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main id="main-content" class="main-content hidden">
        
        <!-- Page de connexion -->
        <div id="login-page" class="page active">
            <div class="login-container">
                <div class="login-header">
                    <h1>Matix Livreur</h1>
                    <p>Système de gestion des commandes</p>
                </div>
                
                <form id="login-form" class="login-form">
                    <div class="form-group">
                        <label for="login-username">Nom d'utilisateur</label>
                        <input type="text" id="login-username" name="username" required autocomplete="username">
                    </div>
                    
                    <div class="form-group">
                        <label for="login-password">Mot de passe</label>
                        <div class="password-input">
                            <input type="password" id="login-password" name="password" required autocomplete="current-password">
                            <button type="button" class="password-toggle" data-target="login-password">
                                <span class="icon">👁️</span>
                            </button>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-full">
                        Se connecter
                    </button>
                    
                    <button type="button" id="change-password-link" class="btn btn-link">
                        Changer de mot de passe
                    </button>
                </form>
                
                <div id="login-error" class="error-message hidden"></div>
            </div>
        </div>

        <!-- Page tableau de bord -->
        <div id="dashboard-page" class="page">
            <div class="page-header">
                <h2>Tableau de bord</h2>
                <div class="page-actions">
                    <button id="refresh-dashboard" class="btn btn-secondary btn-sm">
                        <span class="icon">🔄</span>
                        Actualiser
                    </button>
                </div>
            </div>
            
            <!-- Dashboard Date Filter -->
            <div class="dashboard-filters" style="margin-bottom: 1rem; display: flex; align-items: center; gap: 10px; padding: 0 1rem;">
                <label for="dashboard-date-filter" style="font-weight: bold;">Afficher pour le:</label>
                <input type="date" id="dashboard-date-filter" name="dashboard-date" class="form-control" style="width: auto; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
            </div>
            
            <div class="dashboard-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">📦</div>
                        <div class="stat-content">
                            <h3 id="total-orders-today">0</h3>
                            <p id="orders-today-label">Commandes aujourd'hui</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">🏷️</div>
                        <div class="stat-content">
                            <h3 id="total-amount-today">0</h3>
                            <p>Courses</p>
                        </div>
                    </div>
                    <div class="stat-card" id="stat-depenses">
                        <div class="stat-icon">📉</div>
                        <div class="stat-content">
                            <h3 id="total-expenses-today">0</h3>
                            <p>Dépenses</p>
                        </div>
                    </div>
                    <div class="stat-card" id="stat-benefice">
                        <div class="stat-icon">💰</div>
                        <div class="stat-content">
                            <h3 id="total-benefice-today">0</h3>
                            <p>Bénéfice</p>
                        </div>
                    </div>
                </div>
                
                <div class="recent-orders">
                    <h3>Dernières commandes</h3>
                    <div id="recent-orders-list" class="orders-list">
                        <!-- Les commandes seront chargées ici -->
                    </div>
                </div>
                
                <div class="orders-by-type-section hidden" id="orders-by-type-section">
                    <h3>Répartition par type de commande - Aujourd'hui</h3>
                    <div id="orders-by-type-container" class="orders-by-type-grid">
                        <!-- Les statistiques par type seront chargées ici -->
                    </div>
                </div>
                
                <div class="monthly-orders-by-type-section hidden" id="monthly-orders-by-type-section">
                    <h3>Cumul mensuel par type de commande</h3>
                    <div id="monthly-orders-by-type-container" class="orders-by-type-grid">
                        <!-- Les statistiques mensuelles par type seront chargées ici -->
                    </div>
                </div>
                
                <div class="summary-section hidden" id="manager-summary-section">
                    <h3>Récapitulatif par livreur</h3>
                    <div id="summary-table-container">
                        <!-- Le tableau récapitulatif sera chargé ici -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Page tableau de bord mensuel -->
        <div id="monthly-dashboard-page" class="page">
            <div class="page-header">
                <h2>Tableau de bord mensuel</h2>
                            <div class="page-actions">
                <button id="export-monthly-excel" class="btn btn-primary btn-sm">
                    <span class="icon">📊</span>
                    Export Excel
                </button>
                <button id="refresh-monthly-dashboard" class="btn btn-secondary btn-sm">
                    <span class="icon">🔄</span>
                    Actualiser
                </button>
            </div>
            </div>
            
            <!-- Monthly Dashboard Date Filter -->
            <div class="monthly-dashboard-filters" style="margin-bottom: 1rem; display: flex; align-items: center; gap: 10px; padding: 0 1rem;">
                <label for="monthly-dashboard-date-filter" style="font-weight: bold;">Afficher pour le:</label>
                <input type="month" id="monthly-dashboard-date-filter" name="monthly-dashboard-date" class="form-control" style="width: auto; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
            </div>
            
            <div class="monthly-dashboard-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">📦</div>
                        <div class="stat-content">
                            <h3 id="monthly-total-orders">0</h3>
                            <p id="monthly-orders-label">Commandes</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">🏷️</div>
                        <div class="stat-content">
                            <h3 id="monthly-total-amount">0 FCFA</h3>
                            <p>Courses</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">📉</div>
                        <div class="stat-content">
                            <h3 id="monthly-total-expenses">0 FCFA</h3>
                            <p>Dépenses totales</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">💰</div>
                        <div class="stat-content">
                            <h3 id="monthly-total-benefice">0 FCFA</h3>
                            <p>Bénéfice du mois</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">🚚</div>
                        <div class="stat-content">
                            <h3 id="monthly-active-livreurs">0</h3>
                            <p>Livreurs actifs</p>
                        </div>
                    </div>
                </div>
                
                <div class="monthly-orders-by-type-section hidden" id="monthly-orders-by-type-section">
                    <h3>Cumul mensuel par type de commande</h3>
                    <div id="monthly-orders-by-type-container" class="orders-by-type-grid">
                        <!-- Les statistiques mensuelles par type seront chargées ici -->
                    </div>
                </div>
                
                <div class="monthly-summary-by-type-section">
                    <h3>Répartition par type par livreur</h3>
                    <div id="monthly-summary-by-type-container">
                        <!-- Le tableau de répartition par type par livreur sera chargé ici -->
                    </div>
                </div>
                
                <div class="monthly-summary-section">
                    <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3>Récapitulatif par livreur</h3>
                        <button id="export-monthly-summary-excel" class="btn btn-primary btn-sm">
                            <span class="icon">📊</span>
                            Export Excel
                        </button>
                    </div>
                    <div id="monthly-summary-table-container">
                        <!-- Le tableau récapitulatif mensuel sera chargé ici -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Page tableau de bord MATA mensuel -->
        <div id="mata-monthly-dashboard-page" class="page">
            <div class="page-header">
                <h2>Tableau de bord mensuel MATA</h2>
                <div class="page-actions">
                    <button id="refresh-mata-monthly-dashboard" class="btn btn-secondary btn-sm">
                        <span class="icon">🔄</span>
                        Actualiser
                    </button>
                </div>
            </div>
            
            <!-- MATA Monthly Dashboard Date Filter -->
            <div class="mata-monthly-dashboard-filters" style="margin-bottom: 1rem; display: flex; align-items: center; gap: 15px; padding: 0 1rem; flex-wrap: wrap;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <label for="mata-monthly-date-filter" style="font-weight: bold;">Afficher pour le:</label>
                    <input type="month" id="mata-monthly-date-filter" name="mata-monthly-date" class="form-control" style="width: auto; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                </div>
                
                <div style="display: flex; align-items: center; gap: 10px;">
                    <label for="mata-date-range-filter" style="font-weight: bold;">Date:</label>
                    <input type="date" id="mata-date-range-filter" class="form-control" placeholder="Filtrer par date" style="width: auto; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                </div>
                
                <div style="display: flex; align-items: center; gap: 10px;">
                    <label for="mata-phone-filter" style="font-weight: bold;">Téléphone:</label>
                    <input type="text" id="mata-phone-filter" class="form-control" placeholder="Rechercher par téléphone" style="width: 200px; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                </div>
                
                <div style="display: flex; align-items: center; gap: 10px;">
                    <label for="mata-point-vente-filter" style="font-weight: bold;">Point de vente:</label>
                    <select id="mata-point-vente-filter" class="form-control" style="width: auto; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="">Tous les points de vente</option>
                        <option value="O.Foire">O.Foire</option>
                        <option value="Mbao">Mbao</option>
                        <option value="Keur Massar">Keur Massar</option>
                        <option value="Sacre Coeur">Sacre Coeur</option>
                    </select>
                </div>
                
                <div style="display: flex; align-items: center; gap: 10px;">
                    <label for="mata-livreur-filter" style="font-weight: bold;">Livreur:</label>
                    <select id="mata-livreur-filter" class="form-control" style="width: auto; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="">Tous les livreurs</option>
                    </select>
                </div>
                
                <div style="display: flex; align-items: center; gap: 10px;">
                    <label for="mata-interne-filter" style="font-weight: bold;">Commande interne:</label>
                    <select id="mata-interne-filter" class="form-control" style="width: auto; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="">Toutes</option>
                        <option value="non">Externes uniquement</option>
                        <option value="oui">Internes uniquement</option>
                    </select>
                </div>
                
                <div style="display: flex; align-items: center; gap: 10px;">
                    <button id="mata-clear-filters" class="btn btn-secondary btn-sm" style="padding: 0.5rem 1rem;">
                        <span class="icon">🔄</span>
                        Effacer filtres
                    </button>
                </div>
            </div>
            
            <div class="mata-monthly-dashboard-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">🛒</div>
                        <div class="stat-content">
                            <h3 id="mata-total-orders">0</h3>
                            <p id="mata-orders-label">Commandes MATA</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">🏷️</div>
                        <div class="stat-content">
                            <h3 id="mata-total-amount">0 FCFA</h3>
                            <p>Montant total</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">🚚</div>
                        <div class="stat-content">
                            <h3 id="mata-active-livreurs">0</h3>
                            <p>Livreurs actifs</p>
                        </div>
                    </div>
                </div>
                
                <div class="mata-orders-section">
                    <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3>Détail des commandes MATA</h3>
                        <div class="mata-actions-buttons" style="display: flex; gap: 0.5rem;">
                            <button id="mata-sentiment-analysis-btn" class="btn btn-secondary btn-sm">
                                <span class="icon">🔍</span>
                                Analyse de Satisfaction Client IA
                            </button>
                            <button id="export-mata-monthly-excel-table" class="btn btn-primary btn-sm">
                                <span class="icon">📊</span>
                                Exporter en Excel
                            </button>
                        </div>
                    </div>
                    <div id="mata-orders-table-container">
                        <!-- Le tableau des commandes MATA sera chargé ici -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Page nouvelle commande -->
        <div id="new-order-page" class="page">
            <div class="page-header">
                <h2>Nouvelle commande</h2>
            </div>
            
            <form id="new-order-form" class="order-form">
                <div class="form-group">
                    <label for="order-type">Type de commande *</label>
                    <select id="order-type" name="order_type" required>
                        <option value="">Sélectionner un type</option>
                        <option value="MATA">MATA</option>
                        <option value="MLC">MLC</option>
                        <option value="AUTRE">AUTRE</option>
                    </select>
                </div>
                <div class="form-group" id="interne-toggle-group" style="display: none;">
                    <label for="interne-toggle">Interne</label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="interne-toggle" name="interne">
                        <label for="interne-toggle"></label>
                    </div>
                </div>
                <div class="form-group" id="subscription-toggle-group" style="display: none;">
                    <label for="use-subscription">Utiliser un abonnement</label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="use-subscription" name="use_subscription">
                        <label for="use-subscription"></label>
                    </div>
                </div>
                <div class="form-group" id="subscription-select-group" style="display: none;">
                    <label for="subscription-select">Sélectionner un abonnement</label>
                    <select id="subscription-select" name="subscription_id">
                        <option value="">Charger les abonnements...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="client-name">Nom du client *</label>
                    <div class="input-group">
                        <input type="text" id="client-name" name="client_name" required>
                        <button type="button" id="select-contact-btn" class="btn btn-secondary" title="Sélectionner depuis les contacts">
                            <span class="icon">📱</span>
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="phone-number">Numéro de téléphone *</label>
                    <input type="tel" id="phone-number" name="phone_number" required 
                           placeholder="Sénégal: 775059793 | France: 33762051319">
                </div>
                <div class="form-group" id="adresse-source-group" style="display: none;">
                    <label for="adresse-source">Adresse source *</label>
                    <textarea id="adresse-source" name="adresse_source" rows="2" placeholder="Adresse de départ"></textarea>
                </div>
                <div class="form-group" id="adresse-destination-group" style="display: none;">
                    <label for="adresse-destination">Adresse destination *</label>
                    <textarea id="adresse-destination" name="adresse_destination" rows="2" placeholder="Adresse d'arrivée"></textarea>
                </div>
                <div class="form-group" id="point-vente-group" style="display: none;">
                    <label for="point-vente">Point de vente *</label>
                    <select id="point-vente" name="point_de_vente">
                        <option value="">Sélectionner un point de vente</option>
                        <option value="O.Foire">O.Foire</option>
                        <option value="Mbao">Mbao</option>
                        <option value="Keur Massar">Keur Massar</option>
                        <option value="Sacre Coeur">Sacre Coeur</option>
                    </select>
                </div>
                <div class="form-group" id="address-group" style="display: none;">
                    <label for="address">Adresse</label>
                    <textarea id="address" name="address" rows="3" placeholder="Adresse de livraison (optionnel)"></textarea>
                </div>
                <div class="form-group">
                    <label for="description">Description</label>
                    <textarea id="description" name="description" rows="4" 
                              placeholder="Description détaillée de la commande"></textarea>
                </div>
                <div class="form-group" id="livreur-select-group" style="display: none;">
                    <label for="livreur-select">Livreur (assigner à) *</label>
                    <select id="livreur-select" name="created_by" required>
                        <option value="">Sélectionner un livreur</option>
                        <!-- Options dynamiques JS -->
                    </select>
                </div>

                <!-- Nouveau groupe pour les zones MLC sans abonnement -->
                <div class="form-group" id="mlc-zone-group" style="display: none;">
                    <label for="mlc-zone">Sélectionner la zone de livraison *</label>
                    <select id="mlc-zone" name="mlc_zone">
                        <option value="">Sélectionner une zone</option>
                        <option value="zone1" data-price="1750">Zone 1 - Dakar (1750 FCFA)</option>
                        <option value="zone2" data-price="2000">Zone 2 - Proche (2000 FCFA)</option>
                        <option value="zone3" data-price="3000">Zone 3 - Banlieue (3000 FCFA)</option>
                        <option value="zone4" data-price="custom">Zone 4 - Autre (prix libre)</option>
                    </select>
                    
                    <!-- Informations des zones -->
                    <div class="zone-info" id="zone-info" style="display: none; margin-top: 10px; padding: 10px; background-color: #f8f9fa; border-radius: 6px; font-size: 14px;">
                        <div id="zone1-info" class="zone-detail" style="display: none;">
                            <strong>Zone 1 - Dakar (1750 FCFA):</strong><br>
                            Sacré-Cœur, Sicap, Almadies, Yoff, Point E, Fann, Mermoz, etc.
                        </div>
                        <div id="zone2-info" class="zone-detail" style="display: none;">
                            <strong>Zone 2 - Proche (2000 FCFA):</strong><br>
                            Parcelles, Guédiawaye, Pikine, Grand Yoff, HLM, etc.
                        </div>
                        <div id="zone3-info" class="zone-detail" style="display: none;">
                            <strong>Zone 3 - Banlieue (3000 FCFA):</strong><br>
                            Keur Massar, Rufisque, Mbao, Sangalkam, Bargny, etc.
                        </div>
                        <div id="zone4-info" class="zone-detail" style="display: none;">
                            <strong>Zone 4 - Autre (prix libre):</strong><br>
                            Pour les destinations non couvertes par les zones 1, 2 et 3. Veuillez saisir le prix manuellement.
                        </div>
                    </div>
                </div>

                <div class="form-group" id="course-price-group" style="display: none;">
                    <label for="course-price">Prix de la course (FCFA)</label>
                    <input type="number" id="course-price" name="course_price" step="0.01" min="0" 
                           value="1500">
                </div>
                
                <!-- Nouveau groupe pour le supplément MLC -->
                <div class="form-group" id="supplement-toggle-group" style="display: none;">
                    <label for="add-supplement">Ajouter supplément</label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="add-supplement" name="add_supplement">
                        <label for="add-supplement"></label>
                    </div>
                </div>

                <!-- Nouveau groupe pour le supplément "hors zone" MATA -->
                <div class="form-group" id="mata-hors-zone-group" style="display: none;">
                    <label for="mata-hors-zone">Hors zone (+1000 FCFA)</label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="mata-hors-zone" name="mata_hors_zone">
                        <label for="mata-hors-zone"></label>
                    </div>
                </div>
                
                <div class="form-group" id="supplement-options-group" style="display: none;">
                    <label>Montant du supplément (FCFA)</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="supplement-500" name="supplement_amount" value="500">
                            <label for="supplement-500">500 FCFA</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="supplement-1000" name="supplement_amount" value="1000">
                            <label for="supplement-1000">1000 FCFA</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="supplement-1500" name="supplement_amount" value="1500">
                            <label for="supplement-1500">1500 FCFA</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="supplement-other" name="supplement_amount" value="other">
                            <label for="supplement-other">Autre</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group" id="supplement-custom-group" style="display: none;">
                    <label for="supplement-custom-amount">Montant personnalisé (FCFA)</label>
                    <input type="number" id="supplement-custom-amount" name="supplement_custom_amount" 
                           step="0.01" min="0" placeholder="Entrer le montant">
                </div>
                
                <div class="form-group" id="amount-group" style="display: none;">
                    <label for="amount">Montant du panier (FCFA)</label>
                    <input type="number" id="amount" name="amount" step="0.01" min="0" 
                           placeholder="0.00">
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <span class="icon">✅</span>
                        Créer la commande
                    </button>
                    <button type="reset" class="btn btn-secondary">
                        <span class="icon">🔄</span>
                        Réinitialiser
                    </button>
                </div>
            </form>
            
            <div class="recent-user-orders">
                <h3>Mes 5 dernières commandes</h3>
                <div id="user-recent-orders" class="orders-list">
                    <!-- Les dernières commandes de l'utilisateur -->
                </div>
            </div>
        </div>

        <!-- Page commandes -->
        <div id="orders-page" class="page">
            <div class="page-header">
                <h2>Commandes enregistrées</h2>
                <div class="page-actions">
                    <input type="date" id="orders-date-filter" class="date-input">
                    <button id="export-excel" class="btn btn-primary btn-sm hidden">
                        <span class="icon">📊</span>
                        Export Excel
                    </button>
                </div>
            </div>
            
            <div class="orders-content">
                <div id="orders-list" class="orders-list">
                    <!-- Les commandes seront chargées ici -->
                </div>
                
                <div class="pagination hidden" id="orders-pagination">
                    <button id="prev-page" class="btn btn-secondary btn-sm">Précédent</button>
                    <span id="page-info">Page 1 sur 1</span>
                    <button id="next-page" class="btn btn-secondary btn-sm">Suivant</button>
                </div>
            </div>
        </div>

        <!-- Page dépenses -->
        <div id="expenses-page" class="page">
            <div class="page-header">
                <h2>Gestion des dépenses</h2>
                <div class="page-actions">
                    <div class="date-filter-group">
                        <label for="expenses-date-filter" style="font-weight: 600; color: #374151; margin-right: 0.5rem; cursor: pointer;">Date :</label>
                        <div style="position: relative; display: inline-block;">
                            <input 
                                type="date" 
                                id="expenses-date-filter" 
                                class="date-input" 
                                title="Cliquer pour sélectionner une date"
                                placeholder="Sélectionner une date"
                                style="pointer-events: auto; cursor: pointer; padding-right: 35px;"
                            >
                            <button 
                                type="button" 
                                id="date-picker-helper" 
                                style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 16px; color: #2563eb;"
                                title="Ouvrir le sélecteur de date"
                            >📅</button>
                        </div>
                    </div>
                    <button id="add-expense-btn" class="btn btn-primary btn-sm hidden" data-manager-only>
                        <span class="icon">➕</span>
                        Nouvelle dépense
                    </button>
                </div>
            </div>
            
            <div class="expenses-content">
                <div id="expenses-summary" class="expenses-summary">
                    <!-- Le récapitulatif des dépenses sera chargé ici -->
                </div>
            </div>
        </div>

        <!-- Page utilisateurs (managers/admins) -->
        <div id="users-page" class="page">
            <div class="page-header">
                <h2>Gestion des utilisateurs</h2>
                <div class="page-actions">
                    <button id="add-user-btn" class="btn btn-primary btn-sm">
                        <span class="icon">➕</span>
                        Nouvel utilisateur
                    </button>
                </div>
            </div>
            
            <div class="users-content">
                <div id="users-list" class="users-list">
                    <!-- Les utilisateurs seront chargés ici -->
                </div>
            </div>
        </div>

        <!-- Page abonnements MLC (managers/admins) -->
        <div id="subscriptions-page" class="page">
            <div class="page-header">
                <h2>Gestion des abonnements MLC</h2>
                <div class="page-actions">
                    <input type="text" id="subscription-search" placeholder="Rechercher par nom, téléphone ou numéro de carte..." class="search-input">
                    <button id="add-subscription-btn" class="btn btn-primary btn-sm">
                        <span class="icon">🎫</span>
                        Nouvelle carte
                    </button>
                    <button id="refresh-subscriptions" class="btn btn-secondary btn-sm">
                        <span class="icon">🔄</span>
                        Actualiser
                    </button>
                </div>
            </div>
            
            <div class="subscriptions-content">
                <div class="subscriptions-stats">
                    <div class="stat-card">
                        <div class="stat-icon">🎫</div>
                        <div class="stat-content">
                            <h3 id="total-subscriptions">0</h3>
                            <p>Total cartes</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">✅</div>
                        <div class="stat-content">
                            <h3 id="active-subscriptions">0</h3>
                            <p>Cartes actives</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">🏁</div>
                        <div class="stat-content">
                            <h3 id="completed-subscriptions">0</h3>
                            <p>Cartes terminées</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">⏸️</div>
                        <div class="stat-content">
                            <h3 id="inactive-subscriptions">0</h3>
                            <p>Cartes inactives</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">⏰</div>
                        <div class="stat-content">
                            <h3 id="expiring-subscriptions">0</h3>
                            <p>Expirent bientôt</p>
                        </div>
                    </div>
                </div>
                <div style="background: linear-gradient(135deg, #2563eb, #3b82f6); padding: 20px; border-radius: 12px; margin-bottom: 20px; text-align: center; box-shadow: 0 8px 25px rgba(37, 99, 235, 0.3);">
                    <button id="add-subscription-btn-main" class="btn btn-primary btn-sm" data-manager-only style="
                      background: #ffffff; 
                      color: #2563eb; 
                      border: none; 
                      padding: 15px 30px; 
                      font-size: 18px; 
                      font-weight: bold; 
                      border-radius: 8px; 
                      cursor: pointer; 
                      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                      transition: all 0.3s ease;
                    ">
                      ➕ AJOUTER UNE NOUVELLE CARTE
                    </button>
                    <p style="color: white; margin-top: 10px; font-size: 14px;">Cliquez ici pour créer un nouveau livreur</p>
                  </div>
                
                <div class="subscriptions-section">
                    <div class="subscriptions-header">
                        <h3>Cartes d'abonnement</h3>
                        <div class="subscription-filters">
                            <button id="filter-all" class="filter-btn active" data-filter="all">
                                <span class="icon">🎫</span>
                                Toutes (<span id="count-all">0</span>)
                            </button>
                            <button id="filter-active" class="filter-btn" data-filter="active">
                                <span class="icon">✅</span>
                                Actives (<span id="count-active">0</span>)
                            </button>
                            <button id="filter-completed" class="filter-btn" data-filter="completed">
                                <span class="icon">🏁</span>
                                Terminées (<span id="count-completed">0</span>)
                            </button>
                            <button id="filter-inactive" class="filter-btn" data-filter="inactive">
                                <span class="icon">⏸️</span>
                                Inactives (<span id="count-inactive">0</span>)
                            </button>
                        </div>
                    </div>
                    <div id="subscriptions-list" class="subscriptions-list">
                        <!-- Les cartes d'abonnement seront chargées ici -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Page gestion livreurs (managers/admins) -->
        <div id="livreurs-page" class="page">
            <div class="page-header">
                <h2>Gestion des livreurs</h2>
                <div class="page-actions">
                    <button id="add-livreur-btn" class="btn btn-primary btn-sm">
                        <span class="icon">➕</span>
                        Nouveau livreur
                    </button>
                    <button id="show-all-livreurs" class="btn btn-secondary btn-sm">
                        <span class="icon">👁️</span>
                        Voir tous
                    </button>
                    <button id="show-active-livreurs" class="btn btn-secondary btn-sm">
                        <span class="icon">✅</span>
                        Actifs seulement
                    </button>
                </div>
            </div>
            
            <div class="livreurs-content">
                <div class="livreurs-stats">
                    <div class="stat-card">
                        <div class="stat-icon">🚚</div>
                        <div class="stat-content">
                            <h3 id="total-livreurs">0</h3>
                            <p>Total livreurs</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">✅</div>
                        <div class="stat-content">
                            <h3 id="active-livreurs-count">0</h3>
                            <p>Livreurs actifs</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">❌</div>
                        <div class="stat-content">
                            <h3 id="inactive-livreurs-count">0</h3>
                            <p>Livreurs inactifs</p>
                        </div>
                    </div>
                </div>
                
                <div id="livreurs-list" class="livreurs-list">
                    <!-- Les livreurs seront chargés ici -->
                </div>
            </div>
        </div>

        <!-- Page Suivi GPS (managers/admins) -->
        <div id="gps-tracking-page" class="page">
            <div class="page-header">
                <h2>📍 Suivi GPS des livreurs</h2>
                <div class="page-actions">
                    <button id="gps-refresh-btn" class="btn btn-secondary btn-sm gps-refresh-btn">
                        <span class="icon">🔄</span>
                        Actualiser
                    </button>
                </div>
            </div>
            
            <div class="gps-tracking-content">
                <div class="gps-controls-panel">
                    <div class="gps-stats-card">
                        <h3>📊 Statistiques GPS</h3>
                        <div class="gps-stat-item">
                            <span class="gps-stat-label">Livreurs connectés:</span>
                            <span class="gps-stat-value" id="gps-online-count">-</span>
                        </div>
                        <div class="gps-stat-item">
                            <span class="gps-stat-label">Livreurs hors ligne:</span>
                            <span class="gps-stat-value" id="gps-offline-count">-</span>
                        </div>
                        <div class="gps-stat-item">
                            <span class="gps-stat-label">Total avec GPS activé:</span>
                            <span class="gps-stat-value" id="gps-enabled-count">-</span>
                        </div>
                    </div>
                    
                    <div class="gps-livreurs-card">
                        <h3>🚚 Livreurs en ligne</h3>
                        <div id="gps-livreurs-list">
                            <!-- Liste des livreurs sera chargée ici -->
                        </div>
                    </div>
                    
                    <div class="gps-trace-card">
                        <h3>📍 Tracé journalier</h3>
                        <div class="trace-controls">
                            <div class="trace-input-group">
                                <label for="trace-livreur-select">Livreur:</label>
                                <select id="trace-livreur-select" class="trace-select">
                                    <option value="">Sélectionner un livreur</option>
                                </select>
                            </div>
                            
                            <div class="trace-input-group">
                                <label for="trace-date-input">Date:</label>
                                <input type="date" id="trace-date-input" class="trace-date-input">
                            </div>
                            
                            <div class="trace-buttons">
                                <button id="show-trace-btn" class="btn btn-primary btn-sm" disabled>
                                    <span class="icon">📍</span>
                                    Afficher Tracé
                                </button>
                                <button id="clear-trace-btn" class="btn btn-secondary btn-sm" disabled>
                                    <span class="icon">🗑️</span>
                                    Effacer
                                </button>
                            </div>
                        </div>
                        
                        <div id="trace-summary" class="trace-summary" style="display: none;">
                            <div class="trace-summary-header">
                                <h4>📊 Résumé du tracé</h4>
                            </div>
                            <div class="trace-stats">
                                <div class="trace-stat-item">
                                    <span class="trace-stat-label">Distance:</span>
                                    <span class="trace-stat-value" id="trace-distance">-</span>
                                </div>
                                <div class="trace-stat-item">
                                    <span class="trace-stat-label">Durée:</span>
                                    <span class="trace-stat-value" id="trace-duration">-</span>
                                </div>
                                <div class="trace-stat-item">
                                    <span class="trace-stat-label">Vitesse moy.:</span>
                                    <span class="trace-stat-value" id="trace-avg-speed">-</span>
                                </div>
                                <div class="trace-stat-item">
                                    <span class="trace-stat-label">Points GPS:</span>
                                    <span class="trace-stat-value" id="trace-points-count">-</span>
                                </div>
                                <div class="trace-stat-item">
                                    <span class="trace-stat-label">Période:</span>
                                    <span class="trace-stat-value" id="trace-time-range">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="gps-tracking-config-card">
                        <h3>⏰ Configuration des heures de tracking</h3>
                        <div class="tracking-config-controls">
                            <div class="config-summary" id="config-summary">
                                <p>Sélectionnez un livreur pour configurer ses heures de tracking GPS</p>
                            </div>
                            
                            <div class="config-form" id="config-form" style="display: none;">
                                <div class="config-input-group">
                                    <label for="config-livreur-select">Livreur:</label>
                                    <select id="config-livreur-select" class="config-select">
                                        <option value="">Sélectionner un livreur</option>
                                    </select>
                                </div>
                                
                                <div class="config-row">
                                    <div class="config-input-group">
                                        <label for="tracking-start-hour">Heure de début:</label>
                                        <select id="tracking-start-hour" class="config-time-select">
                                            <!-- Options 0-23 will be populated by JS -->
                                        </select>
                                    </div>
                                    
                                    <div class="config-input-group">
                                        <label for="tracking-end-hour">Heure de fin:</label>
                                        <select id="tracking-end-hour" class="config-time-select">
                                            <!-- Options 0-23 will be populated by JS -->
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="config-input-group">
                                    <label>Jours de tracking:</label>
                                    <div class="days-checkboxes">
                                        <label class="day-checkbox">
                                            <input type="checkbox" id="day-1" value="1"> Lundi
                                        </label>
                                        <label class="day-checkbox">
                                            <input type="checkbox" id="day-2" value="2"> Mardi
                                        </label>
                                        <label class="day-checkbox">
                                            <input type="checkbox" id="day-3" value="3"> Mercredi
                                        </label>
                                        <label class="day-checkbox">
                                            <input type="checkbox" id="day-4" value="4"> Jeudi
                                        </label>
                                        <label class="day-checkbox">
                                            <input type="checkbox" id="day-5" value="5"> Vendredi
                                        </label>
                                        <label class="day-checkbox">
                                            <input type="checkbox" id="day-6" value="6"> Samedi
                                        </label>
                                        <label class="day-checkbox">
                                            <input type="checkbox" id="day-0" value="0"> Dimanche
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="config-input-group">
                                    <label class="toggle-label">
                                        <input type="checkbox" id="gps-tracking-active"> 
                                        Tracking GPS activé
                                    </label>
                                </div>
                                
                                <div class="config-buttons">
                                    <button id="save-config-btn" class="btn btn-primary btn-sm" disabled>
                                        <span class="icon">💾</span>
                                        Sauvegarder
                                    </button>
                                    <button id="reset-config-btn" class="btn btn-secondary btn-sm" disabled>
                                        <span class="icon">🔄</span>
                                        Réinitialiser
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="gps-map-container" id="gps-map">
                    🗺️ Carte GPS - OpenStreetMap sera intégrée ici prochainement
                </div>
            </div>
        </div>

        <!-- Page profil -->
        <div id="profile-page" class="page">
            <div class="page-header">
                <h2>👤 Mon Profil</h2>
            </div>
            
            <!-- Onglets de navigation -->
            <div class="profile-tabs">
                <button class="profile-tab active" data-tab="info">
                    <span class="tab-icon">ℹ️</span>
                    <span class="tab-text">Mes Informations</span>
                </button>
                <button class="profile-tab security-tab" data-tab="security">
                    <span class="tab-icon">🔐</span>
                    <span class="tab-text">Sécurité & Mot de passe</span>
                    <span class="tab-indicator">→</span>
                </button>
            </div>
            
            <div class="profile-content">
                <!-- Onglet Informations personnelles -->
                <div id="profile-tab-info" class="profile-tab-content active">
                    <div class="profile-cards-grid">
                        <!-- Card informations personnelles -->
                        <div class="profile-card">
                            <div class="profile-card-header">
                                <h3>👤 Informations personnelles</h3>
                                <span class="profile-card-subtitle">Vos données de compte</span>
                            </div>
                            <div class="profile-card-body">
                                <div class="profile-info-grid">
                                    <div class="info-item">
                                        <div class="info-icon">👤</div>
                                        <div class="info-content">
                        <label>Nom d'utilisateur</label>
                                            <span id="profile-username" class="info-value"></span>
                    </div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-icon">🎭</div>
                                        <div class="info-content">
                        <label>Rôle</label>
                        <span id="profile-role" class="role-badge"></span>
                    </div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-icon">📅</div>
                                        <div class="info-content">
                        <label>Membre depuis</label>
                                            <span id="profile-created" class="info-value"></span>
                                        </div>
                                    </div>
                                </div>
                    </div>
                </div>
                
                        <!-- Interface GPS pour les livreurs -->
                        <div id="gps-livreur-section" class="gps-livreur-section" style="display: none;">
                            <div class="profile-card">
                                <div class="profile-card-header">
                                    <h3>📍 Mon GPS & Géolocalisation</h3>
                                    <span class="profile-card-subtitle">Gérez votre partage de position en temps réel</span>
                                </div>
                                <div class="profile-card-body">
                                    <div id="gps-livreur-interface">
                                        <!-- L'interface GPS sera générée par JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Onglet Sécurité -->
                <div id="profile-tab-security" class="profile-tab-content">
                    <div class="profile-cards-grid">
                        <div class="profile-card security-card">
                            <div class="profile-card-header">
                                <h3>🔒 Sécurité du compte</h3>
                                <span class="profile-card-subtitle">Protégez votre compte avec un mot de passe sécurisé</span>
                            </div>
                            <div class="profile-card-body">
                                <div class="security-warning">
                                    <div class="warning-icon">⚠️</div>
                                    <div class="warning-content">
                                        <h4>Attention</h4>
                                        <p>La modification du mot de passe déconnectera votre compte sur tous les appareils.</p>
                                        <p><strong>Assurez-vous de bien mémoriser votre nouveau mot de passe.</strong></p>
                                    </div>
                                </div>
                                
                                <div class="security-info">
                                    <div class="security-item">
                                        <div class="security-icon">🛡️</div>
                                        <div class="security-content">
                                            <h4>Mot de passe actuel</h4>
                                            <p>Dernière modification : <span class="text-muted">Information non disponible</span></p>
                                            <small class="security-tip">💡 Conseil : Changez votre mot de passe tous les 3 mois</small>
                                        </div>
                                        <div class="security-action">
                                            <button id="change-password-btn-main" class="btn btn-danger btn-sm">
                    <span class="icon">🔐</span>
                                                Modifier mon mot de passe
                </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page Mes Performances (pour livreurs) -->
        <div id="my-performance-page" class="page" style="display: none;">
            <div class="page-header">
                <h2>📈 Mes Performances GPS</h2>
                <div class="page-actions">
                    <button id="refresh-my-performance" class="btn btn-secondary btn-sm">
                        <span class="icon">🔄</span> Actualiser
                    </button>
                </div>
            </div>

            <!-- Statistiques personnelles -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">📏</div>
                    <div class="stat-content">
                        <h3 id="my-distance-today">0 km</h3>
                        <p>Distance aujourd'hui</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">⏱️</div>
                    <div class="stat-content">
                        <h3 id="my-time-today">0h</h3>
                        <p>Temps actif</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">🚀</div>
                    <div class="stat-content">
                        <h3 id="my-speed-avg">0 km/h</h3>
                        <p>Vitesse moyenne</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">⭐</div>
                    <div class="stat-content">
                        <h3 id="my-efficiency-score">0%</h3>
                        <p>Score d'efficacité</p>
                    </div>
                </div>
            </div>

            <!-- Filtres de période -->
            <div class="analytics-filters">
                <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap;">
                    <div>
                        <label for="my-period-select">Période :</label>
                        <select id="my-period-select" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="today">Aujourd'hui</option>
                            <option value="7" selected>7 derniers jours</option>
                            <option value="30">30 derniers jours</option>
                        </select>
                    </div>
                    <div>
                        <button id="export-my-performance" class="btn btn-secondary btn-sm">
                            <span class="icon">📊</span> Exporter mes données
                        </button>
                    </div>
                </div>
            </div>

            <!-- Mon historique -->
            <div class="analytics-section">
                <div class="analytics-header">
                    <h4>📅 Mon Historique</h4>
                </div>
                <div class="analytics-content">
                    <div id="my-history-content">
                        <div class="analytics-loading">
                            <p>📊 Chargement de votre historique...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ma progression -->
            <div class="analytics-section">
                <div class="analytics-header">
                    <h4>📈 Ma Progression</h4>
                </div>
                <div class="analytics-content">
                    <div id="my-progress-chart" style="height: 300px;">
                        <canvas id="my-performance-chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Conseils personnalisés -->
            <div class="analytics-section">
                <div class="analytics-header">
                    <h4>💡 Conseils pour moi</h4>
                </div>
                <div class="analytics-content">
                    <div id="my-tips-content">
                        <div class="alert alert-info">
                            <strong>🎯 Objectifs :</strong><br>
                            <ul>
                                <li>📏 Maintenir une distance quotidienne de 15-25 km</li>
                                <li>🚀 Vitesse optimale : 20-30 km/h en ville</li>
                                <li>⭐ Score d'efficacité cible : >70%</li>
                                <li>⏱️ Optimiser les temps de pause</li>
                            </ul>
                        </div>
                        <div id="personal-recommendations">
                            <!-- Recommandations personnalisées générées dynamiquement -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page Analytics GPS -->
        <div id="gps-analytics-page" class="page" style="display: none;">
            <div class="page-header">
                <h2>📊 Analytics GPS Avancés</h2>
                <div class="page-actions">
                    <button id="calculate-metrics" class="btn btn-primary btn-sm">
                        <span class="icon">🔢</span> Calculer métriques
                    </button>
                    <button id="refresh-all" class="btn btn-secondary btn-sm">
                        <span class="icon">🔄</span> Actualiser tout
                    </button>
                </div>
            </div>

            <!-- Filtres et contrôles -->
            <div class="analytics-filters">
                <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap;">
                    <div>
                        <label for="period-select">Période d'analyse:</label>
                        <select id="period-select" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="7">7 derniers jours</option>
                            <option value="15">15 derniers jours</option>
                            <option value="30" selected>30 derniers jours</option>
                            <option value="60">60 derniers jours</option>
                            <option value="90">90 derniers jours</option>
                        </select>
                    </div>
                    <div>
                        <label for="livreur-filter">Filtrer par livreur:</label>
                        <select id="livreur-filter" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="">Tous les livreurs</option>
                            <!-- Options générées dynamiquement -->
                        </select>
                    </div>
                    <div>
                        <button id="export-performance" class="btn btn-secondary btn-sm">
                            <span class="icon">📊</span> Export Performances
                        </button>
                    </div>
                    <div>
                        <button id="export-trends" class="btn btn-secondary btn-sm">
                            <span class="icon">📈</span> Export Tendances
                        </button>
                    </div>
                </div>
            </div>

            <!-- Section Aperçu Global -->
            <div class="analytics-section">
                <div class="analytics-header">
                    <h4>🎯 Aperçu Global</h4>
                    <button id="refresh-overview" class="btn btn-secondary btn-sm">
                        <span class="icon">🔄</span>
                    </button>
                </div>
                <div class="analytics-content">
                    <div id="overview-content">
                        <div class="analytics-loading">
                            <p>📊 Chargement des données analytics...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section Performances Quotidiennes -->
            <div class="analytics-section">
                <div class="analytics-header">
                    <h4>📈 Performances Quotidiennes</h4>
                    <button id="refresh-performance" class="btn btn-secondary btn-sm">
                        <span class="icon">🔄</span>
                    </button>
                </div>
                <div class="analytics-content">
                    <div id="performance-content">
                        <div class="analytics-loading">
                            <p>📊 Chargement des performances...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section Tendances Hebdomadaires -->
            <div class="analytics-section">
                <div class="analytics-header">
                    <h4>📊 Tendances Hebdomadaires</h4>
                    <button id="refresh-trends" class="btn btn-secondary btn-sm">
                        <span class="icon">🔄</span>
                    </button>
                </div>
                <div class="analytics-content">
                    <div id="trends-content">
                        <div class="analytics-loading">
                            <p>📊 Chargement des tendances...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section Classement des Livreurs -->
            <div class="analytics-section">
                <div class="analytics-header">
                    <h4>🏆 Classement des Livreurs</h4>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <select id="month-selector" style="padding: 4px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="">Mois actuel</option>
                            <!-- Options générées dynamiquement -->
                        </select>
                        <button id="refresh-rankings" class="btn btn-secondary btn-sm">
                            <span class="icon">🔄</span>
                        </button>
                    </div>
                </div>
                <div class="analytics-content">
                    <div id="rankings-content">
                        <div class="analytics-loading">
                            <p>🏆 Chargement du classement...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section Status -->
            <div class="analytics-section">
                <div class="analytics-header">
                    <h4>ℹ️ Informations Système</h4>
                </div>
                <div class="analytics-content">
                    <div class="alert alert-info">
                        <strong>📈 Système Analytics GPS</strong><br>
                        Les analytics GPS permettent de suivre les performances des livreurs en temps réel.
                        <br><br>
                        <strong>🚀 Fonctionnalités disponibles :</strong>
                        <ul>
                            <li>📊 Aperçu global des performances</li>
                            <li>📈 Suivi des performances quotidiennes</li>
                            <li>📊 Analyse des tendances hebdomadaires</li>
                            <li>🏆 Classement des livreurs</li>
                            <li>📋 Export des données en CSV</li>
                        </ul>
                        <br>
                        <strong>⚠️ Note :</strong> Pour utiliser pleinement les analytics, assurez-vous d'avoir :
                        <ul>
                            <li>✅ Activé le système GPS</li>
                            <li>✅ Exécuté le script SQL d'analytics (add_gps_analytics.sql)</li>
                            <li>✅ Configuré les métriques quotidiennes</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page Tableau MLC -->
        <div id="mlc-table-page" class="page">
            <div class="page-header">
                <h2>Tableau MLC</h2>
                <div class="page-actions">
                    <button id="refresh-mlc-table" class="btn btn-secondary btn-sm">
                        <span class="icon">🔄</span>
                        Actualiser
                    </button>
                </div>
            </div>
            
            <!-- Filtres de date -->
            <div class="mlc-table-filters" style="margin-bottom: 1rem; display: flex; align-items: center; gap: 15px; padding: 0 1rem; flex-wrap: wrap;">
                <label for="mlc-start-date" style="font-weight: bold;">Date de début:</label>
                <input type="date" id="mlc-start-date" name="startDate" class="form-control" style="width: auto; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                
                <label for="mlc-end-date" style="font-weight: bold;">Date de fin:</label>
                <input type="date" id="mlc-end-date" name="endDate" class="form-control" style="width: auto; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                
                <button id="apply-mlc-filters" class="btn btn-primary btn-sm">
                    <span class="icon">🔍</span>
                    Appliquer
                </button>
                
                <button id="export-mlc-table-excel" class="btn btn-success btn-sm">
                    <span class="icon">📊</span>
                    Export Excel
                </button>
            </div>
            
            <!-- Filtres de recherche -->
            <div class="mlc-table-search-filters" style="margin-bottom: 1rem; display: flex; align-items: center; gap: 15px; padding: 0 1rem; flex-wrap: wrap;">
                <label for="mlc-search-client" style="font-weight: bold;">Rechercher client:</label>
                <div class="autocomplete-container" style="position: relative;">
                    <input type="text" id="mlc-search-client" placeholder="Nom du client..." class="form-control autocomplete-input" style="width: 200px; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                    <div id="mlc-client-suggestions" class="autocomplete-suggestions" style="display: none;"></div>
                </div>
                
                <label for="mlc-search-phone" style="font-weight: bold;">Rechercher téléphone:</label>
                <div class="autocomplete-container" style="position: relative;">
                    <input type="text" id="mlc-search-phone" placeholder="Numéro de téléphone..." class="form-control autocomplete-input" style="width: 200px; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                    <div id="mlc-phone-suggestions" class="autocomplete-suggestions" style="display: none;"></div>
                </div>
                
                <button id="apply-mlc-search" class="btn btn-primary btn-sm">
                    <span class="icon">🔍</span>
                    Appliquer
                </button>
                
                <button id="clear-mlc-search" class="btn btn-secondary btn-sm">
                    <span class="icon">🗑️</span>
                    Effacer
                </button>
            </div>
            
            <div class="mlc-table-content">
                <div id="mlc-table-container">
                    <div class="loading-message">
                        <p>📊 Chargement du tableau MLC...</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modales -->
    <div id="modal-overlay" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modal-title">Titre</h3>
                <button id="modal-close" class="modal-close">×</button>
            </div>
            <div class="modal-content" id="modal-content">
                <!-- Contenu dynamique -->
            </div>
        </div>
    </div>

    <!-- Messages toast -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Scripts -->
    <!-- Chart.js for analytics (local) -->
    <script src="assets/js/chart.min.js"></script>
    
    <!-- Leaflet for interactive maps (local) -->
    <script src="assets/leaflet/leaflet.js"></script>
    
    <script src="js/main.js"></script>
    <script src="js/my-performance.js"></script>
    <script src="js/gps-livreur.js"></script>
    <script src="js/gps-manager.js"></script>
    <script src="js/gps-tracking-manager.js"></script>
    <script src="js/mata-sentiment.js"></script>
    <script src="js/gps-analytics.js"></script>
    <script src="js/mlc-table.js"></script>
</body>
</html> 